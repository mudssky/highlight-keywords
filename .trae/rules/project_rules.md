# 项目规则文档

该项目是一个高亮关键词的油猴脚本

## 代码风格规范

### CSS 样式规范

- **优先使用 Tailwind CSS**：所有样式应优先使用 Tailwind CSS 类名，避免内联样式
- **渐变背景处理**：对于复杂的渐变背景，可以保留内联样式，但其他属性应使用 Tailwind 类
- **响应式设计**：使用 Tailwind 的响应式前缀（sm:, md:, lg:, xl:）来处理不同屏幕尺寸
- **颜色透明度**：使用 Tailwind 的透明度语法（如 `bg-white/10` 表示 10% 透明度的白色）

### Vue 组件规范

- **组合式 API**：优先使用 Vue 3 的组合式 API（Composition API）
- **TypeScript 支持**：所有组件必须使用 TypeScript，确保类型安全
- **响应式数据**：使用 `ref()` 和 `reactive()` 来管理组件状态
- **生命周期钩子**：使用 `onMounted()`, `onUnmounted()` 等组合式 API 的生命周期钩子

### 命名规范

- **变量命名**：使用 camelCase 命名法
- **组件名称**：使用 PascalCase 命名法
- **CSS 类名**：使用 kebab-case 命名法（Tailwind 类除外）
- **文件命名**：Vue 组件文件使用 kebab-case 命名

## 技术栈要求

### 前端框架

- **Vue 3**：使用最新版本的 Vue 3
- **Element Plus**：UI 组件库使用 Element Plus
- **Tailwind CSS**：样式框架使用 Tailwind CSS

### 开发工具

- **Vite**：构建工具使用 Vite
- **TypeScript**：必须使用 TypeScript 进行开发
- **ESLint + Prettier**：代码格式化和质量检查

### 用户脚本特定要求

- **Tampermonkey API**：正确使用 GM_* API 函数
- **单例模式**：高亮器等核心功能使用单例模式管理
- **内存管理**：组件卸载时必须清理定时器、事件监听器等资源
- **样式隔离**：使用 Tailwind CSS 时必须在 main.ts 中导入样式文件
- **构建配置**：确保 vite-plugin-monkey 正确配置，样式被打包到用户脚本中
- **权限管理**：在 userscript 配置中明确声明所需的 GM_* 权限
- **运行时机**：设置 'run-at': 'document-end' 确保 DOM 完全加载
- **匹配规则**：合理配置 match 和 exclude 规则，避免在不必要的页面运行
- **外部依赖**：使用 CDN 方式引入 Vue 和 Element Plus，减少打包体积
- **样式冲突**：禁用 Tailwind 的 preflight 样式，避免污染宿主页面

## 油猴脚本开发规范

### 脚本配置

- **元数据块**：正确配置 @name、@namespace、@version、@description 等元数据
- **匹配规则**：使用 @match 和 @exclude 精确控制脚本运行范围
- **权限声明**：通过 @grant 声明所需的 GM_* API 权限
- **更新机制**：配置 @updateURL 和 @downloadURL 支持自动更新
- **运行时机**：根据需要设置 @run-at 控制脚本执行时机

### 样式处理

- **CSS 注入**：确保样式文件被正确导入到 main.ts 中
- **样式隔离**：避免样式污染宿主页面，禁用 Tailwind preflight
- **动态样式**：使用 createElement('style') 动态注入样式
- **优先级控制**：合理使用 !important 和 CSS 选择器优先级

### 性能优化

- **外部依赖**：大型库（Vue、Element Plus）使用 CDN 引入
- **代码分割**：合理使用动态导入减少初始加载体积
- **懒加载**：非核心功能延迟加载
- **内存管理**：及时清理事件监听器、定时器等资源

### 兼容性处理

- **浏览器兼容**：确保在主流浏览器的油猴扩展中正常运行
- **页面适配**：处理不同网站的 DOM 结构差异
- **冲突避免**：避免与页面原有脚本和样式冲突
- **错误处理**：添加适当的错误捕获和降级处理

### 安全考虑

- **输入验证**：严格验证用户输入和配置数据
- **XSS 防护**：避免直接插入用户提供的 HTML 内容
- **权限最小化**：只申请必要的 GM_* 权限
- **数据安全**：敏感数据使用 GM_setValue 安全存储

## 功能实现规范

### 高亮功能

- **关键词匹配**：支持大小写敏感/不敏感匹配
- **样式管理**：通过动态插入 style 标签管理高亮样式
- **导航功能**：提供上一个/下一个/清除高亮的导航功能

### 用户界面

- **响应式面板**：右侧导航面板支持展开/收起、固定/取消固定
- **主题支持**：提供多种预设主题（默认、深色、现代、简约）
- **配置管理**：支持 JSON 格式的配置导入/导出

### 性能优化

- **懒加载**：只在匹配到关键词时才加载高亮功能
- **防抖处理**：用户交互使用适当的防抖处理
- **内存清理**：及时清理不再使用的 DOM 元素和事件监听器

## 安全规范

### 数据处理

- **输入验证**：所有用户输入必须进行验证
- **XSS 防护**：避免直接插入用户提供的 HTML 内容
- **配置安全**：配置文件格式验证，防止恶意配置

### 权限管理

- **最小权限**：只请求必要的 Tampermonkey 权限
- **域名限制**：明确指定脚本运行的域名范围

## 测试要求

### 功能测试

- **核心功能**：高亮、导航、配置管理等核心功能必须经过测试
- **边界情况**：测试空关键词、大量关键词等边界情况
- **兼容性**：确保在主流浏览器中正常运行

### 性能测试

- **大文档处理**：测试在大型网页中的性能表现
- **内存泄漏**：检查是否存在内存泄漏问题

## 文档要求

### 代码注释

- **函数注释**：所有公共函数必须有 JSDoc 注释
- **复杂逻辑**：复杂的业务逻辑必须有详细注释
- **TODO 标记**：未完成的功能使用 TODO 标记

### README 文档

- **安装说明**：详细的安装和使用说明
- **配置示例**：提供完整的配置示例
- **常见问题**：列出常见问题和解决方案

## 版本管理

### Git 规范

- **提交信息**：使用规范的提交信息格式（feat:, fix:, docs:, style:, refactor:, test:, chore:）
- **分支管理**：使用 feature 分支进行功能开发
- **代码审查**：重要功能变更需要代码审查

### 发布流程

- **版本号**：遵循语义化版本号规范
- **变更日志**：维护详细的变更日志
- **测试验证**：发布前必须通过完整测试

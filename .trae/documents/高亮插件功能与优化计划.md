## 目标概述
- 增强高亮功能的灵活性与可配置性，覆盖更多真实使用场景。
- 提升大型页面下的性能与稳定性，降低资源占用。
- 优化交互体验与可视反馈，提升导航与可用性。
- 收敛 Tampermonkey 权限、完善配置校验与安全性。
- 保持样式隔离与工程一致性，遵循项目规则与现有架构。

## 功能增强
- 匹配选项开关：在配置与 UI 中支持 `caseSensitive`、`wholeWord`、`regex` 切换，映射到高亮流程。
  - 触点：`src/views/app/components/ConfigDialog.vue`、`src/views/app/hook.ts:highlightMatchedKeywords`、`src/util/tools.ts:initHighlighter/highlightKeywords`
- 关键词分组样式：按规则或分组给不同关键词设定主题色/样式，支持组内导航。
  - 触点：`src/views/app/config.ts`（数据结构）、`src/util/util.ts:generateHighlightStyle`、`src/views/app/components/NavigationPanel.vue`
- 忽略区域选择器：支持配置如代码块、导航栏等选择器，避免在这些区域高亮。
  - 触点：`src/views/app/config.ts`（新增字段）、`src/util/tools.ts:highlightKeywords`（过滤逻辑）
- 增量高亮（DOM 观察）：使用 `MutationObserver` 监听新增文本节点并做增量处理，避免全量重扫。
  - 触点：`src/views/app/hook.ts`（生命周期与清理）、`src/util/tools.ts`（增量 apply）
- 更精细的 URL 规则：支持 `match`/`exclude` 多条规则、域名/路径/查询分域匹配。
  - 触点：`src/views/app/config.ts:validateConfig`、`src/views/app/hook.ts:matchedRuleList/matchedKeywords`
- 全局快捷键：上一/下一/启用/清除快捷键（可配置/启停），提升导航效率。
  - 触点：`src/views/app/index.vue`（注册/卸载）、`src/views/app/components/NavigationPanel.vue`
- 定位历史与列表：显示所有命中位置列表，支持点击跳转及历史回退。
  - 触点：`src/views/app/components/NavigationPanel.vue`、`src/views/app/hook.ts`（维护索引）
- 高亮统计与导出：统计命中数量、分组分布，支持 CSV 导出。
  - 触点：`src/views/app/components/DebugDialog.vue`、`src/views/app/hook.ts`
- 用户主题：支持自定义 CSS 变量，扩展 `themePresets` 并实时预览。
  - 触点：`src/views/app/config.ts:themePresets`、`src/util/util.ts:generateHighlightStyle`、`src/views/app/components/ConfigDialog.vue`

## 性能优化
- 分块/批处理扫描：将高亮遍历拆分为小批次（`requestIdleCallback`/`setTimeout`），避免主线程长时间阻塞。
  - 触点：`src/util/tools.ts:highlightKeywords/apply`
- 跳过大型容器：对超长节点（如大表格/代码区）按选择器或长度阈值跳过或降级处理。
  - 触点：`src/util/tools.ts`（节点过滤）、`src/views/app/config.ts`（新增配置）
- 文本缓存与去重：对已处理文本节点建立弱引用缓存，避免重复扫描。
  - 触点：`src/util/tools.ts`
- 节流/防抖：用户触发（启用/清除/导航/预览）统一节流，降低抖动与多次渲染。
  - 触点：`src/views/app/hook.ts`、`src/views/app/components/*`
- 异步队列：高亮任务采用队列管理，支持取消与优先级（导航优先）。
  - 触点：`src/util/tools.ts`（内部队列）、`src/views/app/hook.ts`

## 体验优化
- 面板关闭时长可配置：由固定 1 小时改为可配置并持久化。
  - 触点：`src/views/app/components/TriggerButtons.vue`、`src/views/app/hook.ts`
- 状态记忆与恢复：夜间模式、固定状态随页面域名持久化，跨站独立。
  - 触点：`src/views/app/hook.ts`（GM 存储键命名按域名）
- 临时搜索：支持输入临时关键词进行一次性试用，不写入规则。
  - 触点：`src/views/app/components/NavigationPanel.vue`、`src/views/app/hook.ts`
- 滚动定位优化：滚动边距与动画时长可调，避免贴边遮挡。
  - 触点：`src/util/tools.ts:initHighlighter`（滚动参数）、`src/views/app/config.ts`（新增配置）
- 活跃样式强化：`active` 样式统一注入并可配置，提升“当前命中”的可视性。
  - 触点：`src/util/util.ts:generateHighlightStyle`、`src/views/app/components/ConfigDialog.vue`
- 选区内高亮：只在用户选中的区域内应用高亮，便于局部检索。
  - 触点：`src/views/app/hook.ts`（选区获取）、`src/util/tools.ts`（容器参数）

## 配置与安全
- JSON Schema 校验：用 Schema 明确规则结构与错误定位，替代手写校验。
  - 触点：`src/views/app/config.ts:validateConfig`、`src/views/app/components/ConfigDialog.vue`
- 规则预览/测试：在配置面板提供“测试当前页面”功能，显示命中与示例高亮。
  - 触点：`src/views/app/components/ConfigDialog.vue`、`src/views/app/hook.ts`
- 最小权限对齐：对齐 `vite.config.ts` 与产出 `@grant` 的差异，移除未使用权限。
  - 触点：`vite.config.ts`、`dist/highlight-keywords.user.js`（构建核查）
- 域名限制：在配置层支持域名白/黑名单（与 @match/@exclude 对齐），减少误触发。
  - 触点：`src/views/app/config.ts`、`src/views/app/hook.ts`

## 工程化
- 单元测试：对匹配逻辑、样式生成、增量高亮进行测试（模拟 DOM）。
  - 触点：新增测试目录（仅在本地开发环境），不影响用户脚本产物。
- 性能基准：构建“大文档”基准页，量化时间/内存与优化收益。
- 错误监控：在调试面板结构化展示错误与耗时，支持导出 JSON。
- 构建体积优化：CDN 失败时回退方案提示（不内置），提升健壮性。

## 交付顺序（建议）
1) 基础可配置与安全：匹配选项开关、JSON Schema 校验、最小权限对齐。
2) 体验与导航：快捷键、面板关闭时长、活跃样式强化、滚动定位优化。
3) 性能增强：分块扫描、观察者增量高亮、节点过滤与缓存、队列化。
4) 扩展功能：分组样式、临时搜索、定位列表与统计导出、选区内高亮。

## 备注
- 保持 Shadow DOM 与 Tailwind scope（`src/main.ts`、`src/style.css`），所有样式改动走 `generateHighlightStyle` 注入。
- 生命周期清理：新增观察器/快捷键/队列需在退出与清除时彻底释放（遵循项目“内存管理”规范）。
- 变更均遵循组合式 API 与 TypeScript 类型约束，沿用现有命名与结构。